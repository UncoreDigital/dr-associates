// SurveyForm.jsx
import React, { useState } from "react";

const stepsData = [
  "A. About Your Giving",
  "B. How You Decide Where to Give",
  "C. Your Key Priorities",
  "D. Readiness for ZCZP & SSE",
  "E. Fit with Your Strategy",
  "F. Operations & Barriers",
  "G. Contact",
];

const SurveyForm = () => {
  const [currentStep, setCurrentStep] = useState(0);
  const [formData, setFormData] = useState({});
  const [submitted, setSubmitted] = useState(false);

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;

    if (type === "checkbox") {
      const existing = formData[name] || [];
      if (checked) setFormData({ ...formData, [name]: [...existing, value] });
      else
        setFormData({
          ...formData,
          [name]: existing.filter((v) => v !== value),
        });
    } else {
      setFormData({ ...formData, [name]: value });
    }
  };

  const nextStep = () => setCurrentStep((prev) => Math.min(prev + 1, stepsData.length - 1));
  const prevStep = () => setCurrentStep((prev) => Math.max(prev - 1, 0));

  const handleSubmit = async (e) => {
    e.preventDefault();

    try {
      const res = await fetch("http://localhost:5000/send-survey", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });
      const result = await res.json();
      if (result.success) setSubmitted(true);
      else alert("Error: " + result.error);
    } catch (err) {
      alert("Error: " + err.message);
    }
  };

  if (submitted)
    return (
      <div style={{ textAlign: "center", marginTop: "50px" }}>
        <h2>ðŸŽ‰ Thank you for completing the survey!</h2>
        <p>Your responses have been recorded successfully.</p>
      </div>
    );

  return (
    <div style={{ maxWidth: "800px", margin: "50px auto", padding: "20px", border: "1px solid #ccc", borderRadius: "12px" }}>
      <h1 style={{ textAlign: "center" }}>Philanthropic Donor Survey</h1>
      <div style={{ margin: "20px 0", height: "6px", background: "#ddd", borderRadius: "6px", overflow: "hidden" }}>
        <div style={{ height: "100%", width: `${((currentStep + 1) / stepsData.length) * 100}%`, background: "#70507d", transition: "width 0.3s" }}></div>
      </div>

      <form onSubmit={handleSubmit}>
        {/* Step A */}
        {currentStep === 0 && (
          <div>
            <h2>A. About Your Giving</h2>
            <label>Years of active philanthropy:</label>
            <div>
              <label><input type="radio" name="years" value="<5" onChange={handleChange} required /> &lt;5</label>
              <label><input type="radio" name="years" value="5-15" onChange={handleChange} /> 5â€“15</label>
              <label><input type="radio" name="years" value=">15" onChange={handleChange} /> >15</label>
            </div>

            <label>Primary giving vehicle:</label>
            <div>
              <label><input type="radio" name="vehicle" value="Individual" onChange={handleChange} required /> Individual</label>
              <label><input type="radio" name="vehicle" value="Family Foundation" onChange={handleChange} /> Family Foundation</label>
              <label><input type="radio" name="vehicle" value="Corporate Foundation" onChange={handleChange} /> Corporate Foundation</label>
              <label><input type="radio" name="vehicle" value="DAF" onChange={handleChange} /> Donor-advised fund</label>
              <label><input type="radio" name="vehicle" value="Other" onChange={handleChange} /> Other</label>
            </div>

            <label>Annual giving range:</label>
            <div>
              <label><input type="radio" name="range" value="1-10L" onChange={handleChange} required /> â‚¹1â€“10L</label>
              <label><input type="radio" name="range" value="10-50L" onChange={handleChange} /> â‚¹10â€“50L</label>
              <label><input type="radio" name="range" value="50L-2Cr" onChange={handleChange} /> â‚¹50Lâ€“2Cr</label>
              <label><input type="radio" name="range" value="2-10Cr" onChange={handleChange} /> â‚¹2â€“10Cr</label>
              <label><input type="radio" name="range" value=">10Cr" onChange={handleChange} /> >â‚¹10Cr</label>
            </div>

            <div style={{ marginTop: "20px" }}>
              <button type="button" onClick={nextStep} style={{ padding: "8px 16px", background: "#70507d", color: "#fff", border: "none", borderRadius: "6px" }}>Next</button>
            </div>
          </div>
        )}

        {/* Step B */}
        {currentStep === 1 && (
          <div>
            <h2>B. How You Decide Where to Give</h2>
            <label>What most influences your decisions?</label>
            <div>
              <label><input type="checkbox" name="influence" value="Values" onChange={handleChange} /> Personal values</label>
              <label><input type="checkbox" name="influence" value="Impact" onChange={handleChange} /> Evidence of impact</label>
              <label><input type="checkbox" name="influence" value="Peer" onChange={handleChange} /> Peer recommendations</label>
            </div>

            <div style={{ marginTop: "20px" }}>
              <button type="button" onClick={prevStep} style={{ marginRight: "10px", padding: "8px 16px" }}>Back</button>
              <button type="button" onClick={nextStep} style={{ padding: "8px 16px", background: "#70507d", color: "#fff", border: "none", borderRadius: "6px" }}>Next</button>
            </div>
          </div>
        )}

        {/* Step C */}
        {currentStep === 2 && (
          <div>
            <h2>C. Your Key Priorities</h2>
            <label>Focus sectors:</label>
            <div>
              <label><input type="checkbox" name="sectors" value="Education" onChange={handleChange} /> Education</label>
              <label><input type="checkbox" name="sectors" value="Healthcare" onChange={handleChange} /> Healthcare</label>
            </div>

            <div style={{ marginTop: "20px" }}>
              <button type="button" onClick={prevStep} style={{ marginRight: "10px", padding: "8px 16px" }}>Back</button>
              <button type="button" onClick={nextStep} style={{ padding: "8px 16px", background: "#70507d", color: "#fff", border: "none", borderRadius: "6px" }}>Next</button>
            </div>
          </div>
        )}

        {/* Step G (Contact) */}
        {currentStep === stepsData.length - 1 && (
          <div>
            <h2>G. Contact</h2>
            <label>Name & Organization</label>
            <input type="text" name="nameOrg" onChange={handleChange} required />
            <label>Email</label>
            <input type="email" name="email" onChange={handleChange} required />
            <label>Phone</label>
            <input type="tel" name="phone" onChange={handleChange} />

            <div style={{ marginTop: "20px" }}>
              <button type="button" onClick={prevStep} style={{ marginRight: "10px", padding: "8px 16px" }}>Back</button>
              <button type="submit" style={{ padding: "8px 16px", background: "#28a745", color: "#fff", border: "none", borderRadius: "6px" }}>Submit</button>
            </div>
          </div>
        )}
      </form>
    </div>
  );
};

export default SurveyForm;
